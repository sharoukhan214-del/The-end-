<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNAY3Y PRO | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f0f4f8; color: #1e293b; }
        .nav-gradient { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .card-pro { background: white; border-radius: 24px; shadow: 0 10px 25px rgba(0,0,0,0.05); transition: 0.3s; }
        .btn-gold { background: #fbbf24; color: #000; font-weight: 800; border-radius: 15px; }
        .btn-gold:hover { background: #f59e0b; transform: translateY(-2px); }
        .debt-alert { background: #fee2e2; border: 1px solid #ef4444; color: #b91c1c; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <nav class="nav-gradient text-white p-5 sticky top-0 z-50 shadow-xl">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black text-amber-400">SNAY3Y PRO</h1>
            <div class="flex gap-4">
                <button onclick="changeScreen('client')" class="text-sm font-bold border-b-2 border-amber-400">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
                <button onclick="changeScreen('worker')" class="text-sm font-bold text-gray-400">Ø§Ù„ÙÙ†ÙŠÙŠÙ†</button>
            </div>
        </div>
    </nav>

    <main class="max-w-md mx-auto p-4 pt-6">

        <div id="client-screen" class="space-y-6">
            <div class="card-pro p-6 shadow-lg border border-gray-100">
                <h2 class="text-xl font-black mb-5 flex items-center gap-2">ğŸ“ Ø§Ø·Ù„Ø¨ ÙÙ†ÙŠ Ø§Ù„Ø¢Ù†</h2>
                <div class="space-y-4">
                    <input id="order_name" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full p-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-amber-400">
                    <input id="order_phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" class="w-full p-4 bg-gray-100 rounded-2xl outline-none">
                    <select id="order_service" class="w-full p-4 bg-gray-100 rounded-2xl outline-none">
                        <option>Ø³Ø¨Ø§Ùƒ</option><option>ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option><option>ÙÙ†ÙŠ ØªÙƒÙŠÙŠÙ</option><option>Ù†Ø¬Ø§Ø±</option>
                    </select>
                    <textarea id="order_desc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© (Ù…Ø«Ù„Ø§Ù‹: ØªØ³Ø±ÙŠØ¨ Ù…ÙŠØ§Ù‡)" class="w-full p-4 bg-gray-100 rounded-2xl h-28 outline-none"></textarea>
                    <button onclick="pushOrder()" class="btn-gold w-full py-4 text-lg shadow-lg shadow-amber-200">Ù†Ø´Ø± Ø¹Ù„Ù‰ Ø±Ø§Ø¯Ø§Ø± Ø§Ù„ÙÙ†ÙŠÙŠÙ†</button>
                </div>
            </div>
        </div>

        <div id="worker-screen" class="hidden space-y-5">
            <div class="nav-gradient text-white p-6 rounded-3xl shadow-2xl relative overflow-hidden">
                <p class="text-xs opacity-70">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</p>
                <h3 id="debt_val" class="text-3xl font-black text-amber-400">0.00 Ø¬.Ù…</h3>
                <div id="blocked_msg" class="hidden mt-3 p-2 bg-red-600/20 border border-red-500 rounded-lg text-[10px] text-red-200">
                    âš ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø­Ø¸ÙˆØ± Ù„ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (1000Ø¬). ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ø¯Ø§Ø¯ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¯Ø§Ø±.
                </div>
            </div>

            <div class="flex justify-between items-center px-1">
                <h3 class="font-black text-gray-800">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© (Ø±Ø§Ø¯Ø§Ø±)</h3>
                <span class="text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded-full animate-pulse font-bold">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</span>
            </div>

            <div id="radar_list" class="space-y-4">
                </div>
        </div>

    </main>

    <script>
        // --- Ø§Ù„Ø±Ø¨Ø· Ø¨Ù…ÙØ§ØªÙŠØ­Ùƒ Ø§Ù„ØªÙŠ Ù‚Ø¯Ù…ØªÙ‡Ø§ ---
        const firebaseConfig = {
            apiKey: "AIzaSyBp6XDnQj80f1B1c5hW", 
            authDomain: "snay3y-pro.firebaseapp.com",
            databaseURL: "https://snay3y-pro-default-rtdb.firebaseio.com",
            projectId: "snay3y-pro",
            storageBucket: "snay3y-pro.appspot.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        function pushOrder() {
            const name = document.getElementById('order_name').value;
            const phone = document.getElementById('order_phone').value;
            const service = document.getElementById('order_service').value;
            const desc = document.getElementById('order_desc').value;

            if(!name || !phone) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ");

            db.ref('orders').push({
                name, phone, service, desc,
                status: 'open',
                timestamp: Date.now()
            }).then(() => {
                alert("ØªÙ… Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.");
                document.getElementById('order_desc').value = "";
            });
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø§Ø¯Ø§Ø±
        function initRadar() {
            db.ref('orders').on('value', (snapshot) => {
                const list = document.getElementById('radar_list');
                list.innerHTML = "";
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ (Ù…Ø«Ø§Ù„ Ø¨Ù€ LocalStorage Ù„Ù„ØªØ¨Ø³ÙŠØ· Ø­Ø§Ù„ÙŠØ§Ù‹)
                let debt = parseFloat(localStorage.getItem('worker_debt') || 0);
                document.getElementById('debt_val').innerText = debt + " Ø¬.Ù…";
                
                if(debt >= 1000) {
                    document.getElementById('blocked_msg').classList.remove('hidden');
                    return; 
                }

                snapshot.forEach(child => {
                    const data = child.val();
                    if(data.status === 'open') {
                        list.innerHTML += `
                        <div class="card-pro p-5 border-r-8 border-amber-400 shadow-sm">
                            <div class="flex justify-between items-center mb-2">
                                <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-lg text-xs font-black">${data.service}</span>
                                <span class="text-[10px] text-gray-400">${new Date(data.timestamp).toLocaleTimeString('ar-EG')}</span>
                            </div>
                            <h4 class="font-bold text-gray-800">${data.name}</h4>
                            <p class="text-sm text-gray-500 my-3">${data.desc}</p>
                            <div class="grid grid-cols-2 gap-3">
                                <a href="tel:${data.phone}" onclick="handleContact('${child.key}')" class="bg-green-500 text-white text-center py-3 rounded-2xl font-bold text-sm shadow-lg shadow-green-100">ğŸ“ Ø§ØªØµØ§Ù„</a>
                                <a href="https://wa.me/20${data.phone}" onclick="handleContact('${child.key}')" class="bg-slate-800 text-white text-center py-3 rounded-2xl font-bold text-sm shadow-lg shadow-slate-200">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
                            </div>
                        </div>`;
                    }
                });
            });
        }

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„
        function handleContact(orderId) {
            let debt = parseFloat(localStorage.getItem('worker_debt') || 0);
            debt += 20; // Ø®ØµÙ… 20 Ø¬Ù†ÙŠÙ‡ Ø¹Ù…ÙˆÙ„Ø© Ù„ÙƒÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙˆØ§ØµÙ„
            localStorage.setItem('worker_debt', debt);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ØºÙ„Ù‚Ù‡)
            // db.ref('orders/' + orderId).update({ status: 'taken' });
        }

        function changeScreen(scr) {
            document.getElementById('client-screen').classList.toggle('hidden', scr !== 'client');
            document.getElementById('worker-screen').classList.toggle('hidden', scr !== 'worker');
            if(scr === 'worker') initRadar();
        }
    </script>
</body>
</html>
