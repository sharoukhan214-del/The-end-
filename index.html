<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„ØµÙ†Ø§ÙŠØ¹ÙŠØ© - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --bg: #0b1120; --card: #1e293b; --accent: #f59e0b; --blue: #3b82f6; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding-bottom: 70px; }
        .screen { display: none; min-height: 100vh; animation: fadeIn 0.3s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        header { background: #161e2e; padding: 15px; display: flex; justify-content: space-around; border-bottom: 2px solid var(--accent); position: sticky; top:0; z-index:100; }
        header a { color: white; text-decoration: none; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
        .card { background: var(--card); padding: 15px; border-radius: 15px; margin: 12px; border: 1px solid #334155; }
        .btn { border: none; padding: 12px; border-radius: 10px; width: 100%; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #475569; background: #0f172a; color: white; box-sizing: border-box; }
        .map-container { height: 220px; border-radius: 12px; border: 2px solid var(--accent); margin-top: 10px; }
        .job-item { background: #0f172a; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-right: 5px solid var(--blue); }
        .history-card { background: #0f172a; border-radius: 8px; padding: 10px; margin-top: 10px; max-height: 150px; overflow-y: auto; }
        .h-item { display: flex; justify-content: space-between; font-size: 0.8rem; padding: 5px 0; border-bottom: 1px solid #334155; }
    </style>
</head>
<body>

<div id="splash" class="screen active">
    <div style="text-align: center; padding: 40px 20px;">
        <img src="https://img.freepik.com/free-photo/plumber-pointing-side_1368-1033.jpg" style="width:130px; border-radius:50%; border:4px solid var(--accent);" onclick="adminAccess()">
        <h1>Ù…Ù†ØµØ© Ø§Ù„ØµÙ†Ø§ÙŠØ¹ÙŠØ©</h1>
        <p>Live GPS | ÙƒØ´Ù Ø­Ø³Ø§Ø¨ | ØªØ£Ù…ÙŠÙ† Ø¹Ù…ÙˆÙ„Ø§Øª</p>
        <button class="btn" style="background: var(--accent);" onclick="show('reg-client')">Ø£Ù†Ø§ Ø¹Ù…ÙŠÙ„ (Ø£Ø­ØªØ§Ø¬ Ø®Ø¯Ù…Ø©)</button>
        <button class="btn" style="background: var(--blue); color: white;" onclick="show('reg-worker')">Ø£Ù†Ø§ ÙÙ†ÙŠ (Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„)</button>
    </div>
</div>

<div id="client-dash" class="screen">
    <header><a onclick="show('splash')">Ø®Ø±ÙˆØ¬</a></header>
    <div class="card">
        <h3>Ø·Ù„Ø¨ ÙÙ†ÙŠ Ù…ØªØ®ØµØµ</h3>
        <select id="cType"><option value="Ø³Ø¨Ø§ÙƒØ©">Ø³Ø¨Ø§ÙƒØ©</option><option value="Ù†Ø¬Ø§Ø±Ø©">Ù†Ø¬Ø§Ø±Ø©</option><option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option></select>
        <textarea id="cDesc" placeholder="Ø§Ø´Ø±Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©..."></textarea>
        <div id="map-client" class="map-container"></div>
        <button class="btn" style="background: var(--accent);" onclick="submitJob()">Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨ (ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØªØ¨Ø¹)</button>
    </div>
</div>

<div id="reg-worker" class="screen">
    <div class="card">
        <h3>ØªØ³Ø¬ÙŠÙ„ ÙÙ†ÙŠ Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="wName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
        <select id="wSpec"><option value="Ø³Ø¨Ø§ÙƒØ©">Ø³Ø¨Ø§Ùƒ</option><option value="Ù†Ø¬Ø§Ø±Ø©">Ù†Ø¬Ø§Ø±</option><option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option></select>
        <input type="number" id="wID" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (14 Ø±Ù‚Ù…)">
        <button class="btn" style="background: var(--blue); color:white;" onclick="loginWorker()">Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„</button>
    </div>
</div>

<div id="worker-dash" class="screen">
    <header><a onclick="show('worker-wallet')">Ø§Ù„Ù…Ø­ÙØ¸Ø© ğŸ’°</a><a onclick="show('splash')">Ø®Ø±ÙˆØ¬</a></header>
    <div class="card">
        <div id="debt-lock" style="display:none; text-align:center;">
            <h2 style="color:var(--danger)">âš ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ØªÙˆÙ‚Ù</h2>
            <p>Ù…Ø¯ÙŠÙˆÙ†ÙŠØªÙƒ ØªØ¬Ø§ÙˆØ²Øª 1000 Ø¬. ÙŠØ±Ø¬Ù‰ Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</p>
            <button class="btn" style="background:var(--success)" onclick="show('worker-wallet')">Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¢Ù†</button>
        </div>
        <div id="worker-active">
            <p>Ø§Ù„ÙÙ†ÙŠ: <b id="displayWName"></b> | Ø§Ù„ØªØ®ØµØµ: <b id="displayWSpec" style="color:var(--accent)"></b></p>
            <hr>
            <div id="jobList"></div>
        </div>
    </div>
</div>

<div id="job-detail" class="screen">
    <div class="card">
        <h3>Ù…Ù‡Ù…Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° ğŸ› ï¸</h3>
        <p id="detailDesc"></p>
        <div id="map-track" class="map-container"></div>
        <button class="btn" style="background: #25D366; color:white;" onclick="window.open('https://wa.me/201020744825')">ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button class="btn" style="background: var(--danger); color:white;" onclick="window.open('https://wa.me/201020744825?text=SOS_REPORT')">Ø¨Ù„Ø§Øº Ø·ÙˆØ§Ø±Ø¦ SOS ğŸš¨</button>
        <button class="btn" style="background: var(--success); color:white;" onclick="finishJob()">ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
    </div>
</div>

<div id="worker-wallet" class="screen">
    <div class="card">
        <h3>Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©: <b id="debtVal" style="color:var(--danger)">150</b> Ø¬</p>
        <div class="history-card">
            <p style="font-size:0.7rem; color:var(--accent)">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Transaction History):</p>
            <div id="historyList">
                <div class="h-item"><span>Ø±Ø³ÙˆÙ… ÙØªØ­ Ø­Ø³Ø§Ø¨</span><span>150- Ø¬</span></div>
            </div>
        </div>
        <p style="margin-top:15px;">Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ: <b>01020744825</b></p>
        <button class="btn" onclick="show('worker-dash')">Ø±Ø¬ÙˆØ¹</button>
    </div>
</div>

<div id="admin-dash" class="screen">
    <header style="background:var(--danger)"><span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Mohamed214@)</span><a onclick="show('splash')">Ø®Ø±ÙˆØ¬</a></header>
    <div class="card">
        <h3>ÙƒØ´Ù Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„ÙÙ†ÙŠÙŠÙ†</h3>
        <div id="adminWList">
            <div style="display:flex; justify-content:space-between; padding:10px; background:#0f172a;">
                <span id="adminWName">Ø§Ù„ØµÙ†Ø§ÙŠØ¹ÙŠ</span>
                <button onclick="clearDebt()" style="background:var(--success); color:white; border:none; padding:5px 10px; border-radius:5px;">Ø³Ø¯Ø¯</button>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let db = []; 
    let worker = { name: "", spec: "", debt: 150 };

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'client-dash' || id === 'job-detail') initLiveMap(id === 'client-dash' ? 'map-client' : 'map-track');
        if(id === 'worker-dash') checkDebt();
    }

    function initLiveMap(divId) {
        setTimeout(() => {
            navigator.geolocation.getCurrentPosition(pos => {
                let coords = [pos.coords.latitude, pos.coords.longitude];
                var map = L.map(divId).setView(coords, 15);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
                L.marker(coords).addTo(map).bindPopup("Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ").openPopup();
            }, () => alert("Ø¨Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„ GPS"));
        }, 400);
    }

    function submitJob() {
        let type = document.getElementById('cType').value;
        let desc = document.getElementById('cDesc').value;
        if(!desc) return alert("Ø§ÙƒØªØ¨ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©");
        db.push({ id: Date.now(), type, desc, price: 300 });
        alert("ØªÙ… Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ Ø¨Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ!"); show('splash');
    }

    function loginWorker() {
        worker.name = document.getElementById('wName').value;
        worker.spec = document.getElementById('wSpec').value;
        if(!worker.name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…");
        document.getElementById('displayWName').innerText = worker.name;
        document.getElementById('displayWSpec').innerText = worker.spec;
        document.getElementById('adminWName').innerText = worker.name;
        show('worker-dash');
    }

    function checkDebt() {
        if(worker.debt >= 1000) {
            document.getElementById('debt-lock').style.display = 'block';
            document.getElementById('worker-active').style.display = 'none';
        } else {
            document.getElementById('debt-lock').style.display = 'none';
            document.getElementById('worker-active').style.display = 'block';
            renderJobs();
        }
    }

    function renderJobs() {
        let list = document.getElementById('jobList');
        list.innerHTML = "";
        let filtered = db.filter(j => (worker.spec === "Ø³Ø¨Ø§Ùƒ" && j.type === "Ø³Ø¨Ø§ÙƒØ©") || (worker.spec === "Ù†Ø¬Ø§Ø±" && j.type === "Ù†Ø¬Ø§Ø±Ø©") || (worker.spec === "ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ" && j.type === "ÙƒÙ‡Ø±Ø¨Ø§Ø¡"));
        if(filtered.length === 0) { list.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù‚Ø±ÙŠØ¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹"; return; }
        filtered.forEach(j => {
            list.innerHTML += `<div class="job-item"><p>${j.desc}</p><button class="btn" style="background:var(--accent)" onclick="acceptJob(${j.id})">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØªØªØ¨Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</button></div>`;
        });
    }

    function acceptJob(id) {
        let job = db.find(j => j.id === id);
        document.getElementById('detailDesc').innerText = job.desc;
        show('job-detail');
    }

    function finishJob() {
        let commission = 60; // 20% Ù…Ù† 300
        worker.debt += commission;
        document.getElementById('debtVal').innerText = worker.debt;
        document.getElementById('historyList').innerHTML += `<div class="h-item"><span>Ø¹Ù…ÙˆÙ„Ø© Ù…Ù‡Ù…Ø©</span><span>${commission}- Ø¬</span></div>`;
        alert("ØªÙ… Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ÙÙŠ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨");
        show('worker-dash');
    }

    function clearDebt() {
        worker.debt = 0;
        document.getElementById('debtVal').innerText = "0";
        document.getElementById('historyList').innerHTML += `<div class="h-item"><span style="color:var(--success)">Ø³Ø¯Ø§Ø¯ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</span><span>+0 Ø¬</span></div>`;
        alert("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨");
    }

    let clicks = 0;
    function adminAccess() {
        clicks++;
        if(clicks === 3) {
            let p = prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¯ÙŠØ±:");
            if(p === "Mohamed214@") show('admin-dash');
            clicks = 0;
        }
    }
</script>
</body>
</html>
