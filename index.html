<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNAY3Y PRO | Ø§Ù„Ù…Ø§Ø³ØªØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --main-gold: #f59e0b; --bg-dark: #020617; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg-dark); color: white; margin: 0; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
        #map { height: 280px; border-radius: 24px; border: 2px solid #1e293b; z-index: 10; }
        .active-tab { background: var(--main-gold) !important; color: black !important; font-weight: 900; }
        .order-card { border-right: 6px solid var(--main-gold); transition: 0.3s; }
        .order-card:hover { transform: scale(1.02); }
        input, select { background: #0f172a !important; border: 1px solid #334155 !important; color: white !important; }
    </style>
</head>
<body>

    <audio id="order-sound" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"></audio>

    <header class="p-4 border-b border-slate-800 flex justify-between items-center sticky top-0 bg-slate-950/90 backdrop-blur z-[100]">
        <h1 id="logo" class="text-2xl font-black text-amber-500 cursor-pointer select-none" onclick="adminTrigger()">SNAY3Y PRO</h1>
        <div id="wallet-pill" class="hidden flex items-center gap-2 bg-red-500/10 text-red-400 px-3 py-1 rounded-full border border-red-500/20 text-xs font-bold">
            Ø§Ù„Ø¯ÙŠÙˆÙ†: <span id="w-val">0</span> Ø¬.Ù…
        </div>
    </header>

    <main class="p-4 max-w-2xl mx-auto pb-24">
        
        <nav class="flex gap-2 mb-6 bg-slate-900 p-1.5 rounded-2xl">
            <button id="tab-c" onclick="navTo('client')" class="flex-1 py-3 rounded-xl active-tab transition-all">Ø·Ù„Ø¨ ÙÙ†ÙŠ</button>
            <button id="tab-w" onclick="navTo('worker')" class="flex-1 py-3 rounded-xl text-slate-400 font-bold transition-all">Ø£Ù†Ø§ ÙÙ†ÙŠ</button>
        </nav>

        <div id="sec-client" class="space-y-4">
            <div class="glass p-6 rounded-[2.5rem] shadow-2xl">
                <h2 class="text-xl font-black mb-4 text-center">Ø£Ù‚Ø±Ø¨ ØµÙ†Ø§ÙŠØ¹ÙŠ Ù„Ø¨ÙŠØªÙƒ ğŸ› ï¸</h2>
                <input id="c-ph" type="tel" placeholder="Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„Ùƒ" class="w-full p-4 rounded-2xl mb-3 outline-none">
                <select id="c-srv" class="w-full p-4 rounded-2xl mb-4 outline-none">
                    <option value="Ø³Ø¨Ø§Ùƒ">Ø³Ø¨Ø§Ùƒ</option>
                    <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ">ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option>
                    <option value="ØªÙƒÙŠÙŠÙ">ÙÙ†ÙŠ ØªÙƒÙŠÙŠÙ</option>
                </select>
                <div id="map" class="mb-4"></div>
                <button id="send-order-btn" onclick="submitOrder()" class="w-full p-4 bg-amber-500 text-black font-black rounded-2xl shadow-xl active:scale-95 transition-all">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
            </div>
            <div id="status-box" class="hidden glass p-5 rounded-2xl border-r-4 border-amber-500 text-center animate-pulse">
                <p class="font-bold text-amber-400">ğŸ“¡ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ø±Ø§Ø¯Ø§Ø±.. Ø§Ù„ÙÙ†ÙŠÙŠÙ† Ø¨ÙŠØ´ÙˆÙÙˆÙ‡</p>
            </div>
        </div>

        <div id="sec-worker" class="hidden space-y-4">
            <div id="w-form" class="glass p-6 rounded-[2.5rem]">
                <h2 class="text-xl font-black text-amber-500 mb-4 text-center">Ø³Ø¬Ù„ ÙˆØ§Ø±Ø¨Ø­ Ù…Ø¹Ù†Ø§</h2>
                <input id="w-n" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full p-4 rounded-2xl mb-3 outline-none">
                <input id="w-id" type="number" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)" class="w-full p-4 rounded-2xl mb-3 outline-none">
                <select id="w-s" class="w-full p-4 rounded-2xl mb-3 outline-none">
                    <option value="Ø³Ø¨Ø§Ùƒ">Ø³Ø¨Ø§Ùƒ</option>
                    <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ">ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option>
                    <option value="ØªÙƒÙŠÙŠÙ">ÙÙ†ÙŠ ØªÙƒÙŠÙŠÙ</option>
                </select>
                <input id="w-ph" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" class="w-full p-4 rounded-2xl mb-4 outline-none">
                <button onclick="handleWorkerReg()" class="w-full p-4 bg-blue-600 font-black rounded-2xl">Ø·Ù„Ø¨ Ø§Ù†Ø¶Ù…Ø§Ù…</button>
            </div>

            <div id="w-lock" class="hidden glass p-8 rounded-[2.5rem] text-center border-2 border-red-500">
                <h2 class="text-red-500 font-black text-2xl mb-4">Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ØªÙˆÙ‚Ù Ù…Ø¤Ù‚ØªØ§Ù‹</h2>
                <p class="text-sm mb-6 text-slate-300">ØªØ¬Ø§ÙˆØ²Øª Ø­Ø¯ Ø§Ù„Ù€ 1000Ø¬. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„.</p>
                <div class="bg-slate-900 p-4 rounded-2xl mb-6 font-mono text-amber-500 text-xl font-bold tracking-widest">
                    01020744825
                </div>
                <a href="https://wa.me/201020744825" class="block w-full bg-green-600 p-4 rounded-2xl font-black shadow-lg">Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</a>
            </div>

            <div id="w-active" class="hidden space-y-4">
                <div id="radar-ui" class="space-y-4"></div>
            </div>
        </div>

        <div id="sec-admin" class="hidden space-y-4">
            <div class="bg-gradient-to-br from-slate-900 to-slate-800 p-6 rounded-3xl border border-slate-700 text-center shadow-2xl">
                <p class="text-xs text-slate-400 font-bold mb-1">Ø£Ø±Ø¨Ø§Ø­Ùƒ Ø§Ù„Ù…Ø­ØµÙ„Ø© (20%)</p>
                <p id="total-revenue" class="text-4xl font-black text-green-500">0</p>
            </div>
            <div id="pending-workers-list" class="space-y-3"></div>
        </div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. Ø§Ù„ØªØ£Ø³ÙŠØ³
        const firebaseConfig = {
            apiKey: "AIzaSyBp6XDnQj80f1B1c5hW",
            databaseURL: "https://snay3y-pro-default-rtdb.firebaseio.com",
            projectId: "snay3y-pro",
            appId: "1:505251217272:web:d1e53252f3b0dea049d28d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let currentWID = localStorage.getItem('worker_id');

        // 2. Ø§Ù„ØªÙ†Ù‚Ù„
        function navTo(target) {
            ['sec-client', 'sec-worker', 'sec-admin'].forEach(s => document.getElementById(s).classList.add('hidden'));
            document.getElementById('sec-' + target).classList.remove('hidden');
            
            document.getElementById('tab-c').className = "flex-1 py-3 rounded-xl " + (target === 'client' ? 'active-tab' : 'text-slate-400 font-bold');
            document.getElementById('tab-w').className = "flex-1 py-3 rounded-xl " + (target === 'worker' ? 'active-tab' : 'text-slate-400 font-bold');
            
            if(target === 'worker' && currentWID) syncWorker();
        }

        // 3. Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        let map = L.map('map', {zoomControl: false}).setView([30.0444, 31.2357], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        let myMarker;
        map.locate({setView: true, maxZoom: 16});
        map.on('locationfound', e => { if(myMarker) map.removeLayer(myMarker); myMarker = L.marker(e.latlng).addTo(map); });

        // 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
        function submitOrder() {
            const ph = document.getElementById('c-ph').value;
            if(!ph) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„Ùƒ!");
            const btn = document.getElementById('send-order-btn');
            btn.disabled = true;
            btn.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";
            
            db.ref('orders').push({
                ph, srv: document.getElementById('c-srv').value,
                lat: myMarker.getLatLng().lat, lng: myMarker.getLatLng().lng,
                status: 'waiting', ts: Date.now()
            }).then(() => {
                btn.innerHTML = "ØªÙ… Ø§Ù„Ù†Ø´Ø± âœ…";
                document.getElementById('status-box').classList.remove('hidden');
            });
        }

        // 5. Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙ†ÙŠ
        function handleWorkerReg() {
            const idVal = document.getElementById('w-id').value;
            if(idVal.length !== 14) return alert("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­");
            const ref = db.ref('pending_workers').push();
            ref.set({
                name: document.getElementById('w-n').value, nid: idVal,
                ph: document.getElementById('w-ph').value,
                spec: document.getElementById('w-s').value, wallet: 0
            }).then(() => {
                localStorage.setItem('worker_id', ref.key);
                currentWID = ref.key;
                alert("Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©..");
            });
        }

        function syncWorker() {
            db.ref('verified_workers/' + currentWID).on('value', snap => {
                if(!snap.exists()) return;
                const data = snap.val();
                document.getElementById('w-form').classList.add('hidden');
                document.getElementById('wallet-pill').classList.remove('hidden');
                document.getElementById('w-val').innerText = Math.round(data.wallet);
                
                if(data.wallet >= 1000) {
                    document.getElementById('w-lock').classList.remove('hidden');
                    document.getElementById('w-active').classList.add('hidden');
                } else {
                    document.getElementById('w-lock').classList.add('hidden');
                    document.getElementById('w-active').classList.remove('hidden');
                    initRadar(data.spec);
                }
            });
        }

        function initRadar(spec) {
            db.ref('orders').on('value', snap => {
                const ui = document.getElementById('radar-ui');
                ui.innerHTML = '<h3 class="text-center text-green-500 font-bold animate-pulse">ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ø±ØµØ¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù€ ' + spec + '...</h3>';
                let found = false;
                snap.forEach(ch => {
                    const o = ch.val();
                    if(o.status === 'waiting' && o.srv === spec) {
                        found = true;
                        ui.innerHTML += `
                        <div class="order-card glass p-5 rounded-2xl shadow-lg">
                            <div class="flex justify-between items-center mb-4">
                                <span class="bg-amber-500 text-black px-2 py-1 rounded-lg text-[10px] font-black italic">Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±</span>
                                <span class="text-slate-400 text-xs">Ù…Ù†Ø° Ø«ÙˆØ§Ù†Ù</span>
                            </div>
                            <button onclick="takeJob('${ch.key}', '${o.ph}')" class="w-full bg-green-600 py-3 rounded-xl font-black shadow-xl">âœ… Ù‚Ø¨ÙˆÙ„ ÙˆØªÙˆØ§ØµÙ„</button>
                        </div>`;
                    }
                });
                if(found) document.getElementById('order-sound').play();
            });
        }

        function takeJob(id, clientPh) {
            let price = prompt("Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´ØºÙ„Ø§Ù†Ø©:");
            if(price > 0) {
                db.ref('verified_workers/' + currentWID + '/wallet').transaction(w => (w || 0) + (price * 0.2));
                db.ref('orders/' + id).update({ status: 'done', winner: currentWID });
                window.location.href = "tel:" + clientPh;
            }
        }

// --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ·ÙˆØ± ---
let clicks = 0;
function adminTrigger() {
    clicks++;
    if(clicks === 5) {
        let pass = prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:");
        if(pass === "Mohamed214@") {
            navTo('admin');
            loadAdmin();
        }
        clicks = 0;
    }
}

function loadAdmin() {
    const list = document.getElementById('pending-workers-list');
    
    // 1. Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    db.ref('pending_workers').on('value', snap => {
        list.innerHTML = '<h3 class="text-amber-500 font-bold mb-2 mt-4 text-right">â³ Ø·Ù„Ø¨Ø§Øª Ø§Ù†Ø¶Ù…Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø©</h3>';
        if(!snap.exists()) list.innerHTML += '<p class="text-xs text-slate-500 text-right">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>';
        snap.forEach(c => {
            list.innerHTML += `
            <div class="bg-slate-800 p-4 rounded-2xl flex justify-between items-center mb-2 border border-slate-700 text-right" dir="rtl">
                <div class="text-xs">
                    <b class="text-white text-sm">${c.val().name}</b><br>
                    <span class="text-slate-400">${c.val().spec} | ${c.val().ph}</span>
                </div>
                <button onclick="approve('${c.key}')" class="bg-green-600 text-white px-3 py-1 rounded-lg text-xs font-bold">ØªÙˆØ«ÙŠÙ‚</button>
            </div>`;
        });
    });

    // 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙ†ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆØ«Ù‚ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª
    db.ref('verified_workers').on('value', snap => {
        list.innerHTML += '<h3 class="text-blue-500 font-bold mb-2 mt-6 text-right">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙ†ÙŠÙŠÙ† ÙˆØ§Ù„Ø¯ÙŠÙˆÙ†</h3>';
        let totalRev = 0;
        snap.forEach(c => {
            const w = c.val();
            totalRev += (w.wallet || 0);
            list.innerHTML += `
            <div class="bg-slate-900 p-4 rounded-2xl mb-2 border border-slate-800 text-right" dir="rtl">
                <div class="flex justify-between items-center">
                    <div>
                        <b class="text-white block">${w.name}</b>
                        <span class="text-[10px] text-amber-500">Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©: ${Math.round(w.wallet)} Ø¬.Ù…</span>
                    </div>
                    <div class="flex gap-1">
                        <button onclick="clearWallet('${c.key}')" class="bg-amber-600 text-white px-2 py-1 rounded text-[10px] font-bold">Ø¯ÙØ¹</button>
                        <button onclick="deleteWorker('${c.key}')" class="bg-red-900/30 text-red-500 px-2 py-1 rounded text-[10px]">Ø­Ø°Ù</button>
                    </div>
                </div>
            </div>`;
        });
        document.getElementById('total-revenue').innerText = Math.round(totalRev) + " Ø¬.Ù…";
    });
}

function approve(id) {
    db.ref('pending_workers/' + id).once('value', snap => {
        db.ref('verified_workers/' + id).set({...snap.val(), wallet: 0});
        db.ref('pending_workers/' + id).remove();
        alert("ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ÙÙ†ÙŠ âœ…");
    });
}

function clearWallet(id) {
    if(confirm("ØªØµÙÙŠØ± Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„ÙÙ†ÙŠØŸ")) {
        db.ref('verified_workers/' + id).update({ wallet: 0 });
    }
}

function deleteWorker(id) {
    if(confirm("Ø­Ø°Ù Ø§Ù„ÙÙ†ÙŠ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
        db.ref('verified_workers/' + id).remove();
    }
}
    </script>
</body>
</html>
